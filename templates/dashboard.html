<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard ‚Ä¢ ENERGY LIFE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>
<body class="bg">
<div class="shell">
  <header class="top bar">
    <div class="row gap">
      <a class="btn" href="{{ url_for('home') }}">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
      <div>
        <div class="title">üìä Dashboard</div>
        <div class="subtitle">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü (kWh) / ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (‡∏ø) / TOU / Solar / EV</div>
      </div>
    </div>
    <div class="row gap">
      <a class="btn ghost" href="{{ url_for('logout') }}">‡∏≠‡∏≠‡∏Å</a>
    </div>
  </header>

  {% set latest = rows[0] if rows else None %}

  <main class="card">
    <div class="row between">
      <div>
        <div class="title">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
        <div class="muted">
          {% if latest %}
            ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span class="muted small">{{ latest.created_at }}</span>
          {% else %}
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á ‚Äî ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á 1 ‡∏ß‡∏±‡∏ô
          {% endif %}
        </div>
      </div>

      <!-- ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏° (‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå Lv/Badge/‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏ô Dashboard) -->
      <!-- ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏ä‡∏ß‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ -->
      <!--
      <div class="badge">{{ levels[st.house_level-1].badge }}</div>
      -->
    </div>

    <div class="grid3 mt">
      <div class="mini">
        <div class="mini-title">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</div>
        <div class="big">{{ st.state.tariff_mode }}</div>
        <div class="muted small">non_tou / tou</div>
      </div>

      <div class="mini">
        <div class="mini-title">Solar</div>
        <div class="big">{{ st.state.solar_kw }} kW</div>
        <div class="muted small">mode: {{ st.state.solar_mode }}</div>
      </div>

      <div class="mini">
        <div class="mini-title">EV</div>
        <div class="big">{{ "ON" if st.state.ev_enabled else "OFF" }}</div>
        <div class="muted small">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì EV ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ</div>
      </div>
    </div>

    <div class="divider"></div>

    <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
    <div class="grid3 mt">
      <div class="mini">
        <div class="mini-title">kWh ‡∏£‡∏ß‡∏°</div>
        <div class="big">
          {% if latest %}{{ "%.2f"|format(latest.kwh_total) }}{% else %}‚Äî{% endif %}
        </div>
      </div>

      <div class="mini">
        <div class="mini-title">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (‡∏ø)</div>
        <div class="big">
          {% if latest %}{{ "%.2f"|format(latest.cost_thb) }}{% else %}‚Äî{% endif %}
        </div>
      </div>

      <div class="mini">
        <div class="mini-title">‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (TOU)</div>
        <div class="big">
          {% if latest %}
            {{ "%.2f"|format(latest.kwh_on) }} / {{ "%.2f"|format(latest.kwh_off) }}
          {% else %}
            ‚Äî / ‚Äî
          {% endif %}
        </div>
        <div class="muted small">On-Peak / Off-Peak (kWh)</div>
      </div>

      <div class="mini">
        <div class="mini-title">Solar ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á (kWh)</div>
        <div class="big">
          {% if latest %}{{ "%.2f"|format(latest.kwh_solar_used) }}{% else %}‚Äî{% endif %}
        </div>
      </div>

      <div class="mini">
        <div class="mini-title">EV (kWh)</div>
        <div class="big">
          {% if latest %}{{ "%.2f"|format(latest.kwh_ev) }}{% else %}‚Äî{% endif %}
        </div>
      </div>

      <div class="mini">
        <div class="mini-title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏∞‡∏™‡∏°</div>
        <div class="big">{{ rows|length }}</div>
        <div class="muted small">‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡πÅ‡∏ñ‡∏ß</div>
      </div>
    </div>

    <div class="divider"></div>

    <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (30 ‡∏ß‡∏±‡∏ô)</h3>
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            <th>Day</th>
            <th>kWh ‡∏£‡∏ß‡∏°</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (‡∏ø)</th>
            <th>On-Peak kWh</th>
            <th>Off-Peak kWh</th>
            <th>Solar ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á kWh</th>
            <th>EV kWh</th>
            <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>{{ r.day }}</td>
              <td>{{ "%.2f"|format(r.kwh_total) }}</td>
              <td>{{ "%.2f"|format(r.cost_thb) }}</td>
              <td>{{ "%.2f"|format(r.kwh_on) }}</td>
              <td>{{ "%.2f"|format(r.kwh_off) }}</td>
              <td>{{ "%.2f"|format(r.kwh_solar_used) }}</td>
              <td>{{ "%.2f"|format(r.kwh_ev) }}</td>
              <td class="muted small">{{ r.created_at }}</td>
            </tr>
          {% endfor %}
          {% if not rows %}
            <tr><td colspan="8" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Äî ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á 1 ‡∏ß‡∏±‡∏ô</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï: ‡∏õ‡∏∏‡πà‡∏° Export/Report (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥ route) -->
    <!--
    <div class="row gap mt2">
      <a class="btn" href="{{ url_for('export_csv') }}">‚¨áÔ∏è Export CSV</a>
      <a class="btn" href="{{ url_for('export_pdf') }}">‚¨áÔ∏è Export PDF</a>
    </div>
    -->
  </main>
</div>
</body>
</html>
