<!-- templates/admin.html -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Ä¢ ENERGY LIFE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>
<body class="bg">
<div class="shell">
  <header class="top bar">
    <div class="row between">
      <div>
        <div class="title">üõ† Admin</div>
        <div class="subtitle muted">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü/TOU/Ft ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù</div>
      </div>
      <div class="row gap">
        <a class="btn" href="{{ url_for('home') }}">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      </div>
    </div>
  </header>

  <main class="grid2">
    <section class="card">
      <h2>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <div class="grid3 mt2">
        <div class="mini"><div class="mini-title">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div class="big">{{ total_users }}</div></div>
        <div class="mini"><div class="mini-title">Active 7 ‡∏ß‡∏±‡∏ô</div><div class="big">{{ active_7d }}</div></div>
        <div class="mini"><div class="mini-title">Active 30 ‡∏ß‡∏±‡∏ô</div><div class="big">{{ active_30d }}</div></div>
      </div>
      <div class="grid3 mt2">
        <div class="mini"><div class="mini-title">Active ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div><div class="big">{{ todays }}</div></div>
        <div class="mini"><div class="mini-title">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ kWh/‡∏ß‡∏±‡∏ô</div><div class="big">{{ "%.2f"|format(avg_kwh) }}</div></div>
        <div class="mini"><div class="mini-title">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü/‡∏ß‡∏±‡∏ô</div><div class="big">{{ "%.0f"|format(avg_cost) }}</div></div>
      </div>

      <div class="divider"></div>

      <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚Äú‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù</h2>
      <form method="post" action="{{ url_for('admin_settings') }}">
        <h3>‚úÖ Ft</h3>
        <div class="row gap mt2">
          <div class="mini grow">
            <div class="mini-title">Ft (‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="ft_stang_per_kwh" type="number" step="0.01" value="{{ settings.ft_stang_per_kwh }}"/>
          </div>
          <div class="mini grow">
            <div class="mini-title">Label ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏á‡∏ß‡∏î (‡πÄ‡∏ä‡πà‡∏ô 04/2026)</div>
            <input name="ft_label" type="text" value="{{ settings.ft_label }}"/>
          </div>
        </div>

        <div class="divider"></div>

        <h3>‚úÖ Non-TOU (‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î)</h3>
        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">‡∏ä‡∏±‡πâ‡∏ô 1 ‡∏ñ‡∏∂‡∏á (kWh)</div>
            <input name="non_tou_tier1_kwh" type="number" step="1" value="{{ settings.non_tou_tier1_kwh }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏ä‡∏±‡πâ‡∏ô 2 ‡∏ñ‡∏∂‡∏á (kWh)</div>
            <input name="non_tou_tier2_kwh" type="number" step="1" value="{{ settings.non_tou_tier2_kwh }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>
            <input name="non_tou_service_fee" type="number" step="0.01" value="{{ settings.non_tou_service_fee }}"/>
          </div>
        </div>

        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏±‡πâ‡∏ô 1 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_tier1_rate" type="number" step="0.0001" value="{{ settings.non_tou_tier1_rate }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏±‡πâ‡∏ô 2 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_tier2_rate" type="number" step="0.0001" value="{{ settings.non_tou_tier2_rate }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏±‡πâ‡∏ô 3 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_tier3_rate" type="number" step="0.0001" value="{{ settings.non_tou_tier3_rate }}"/>
          </div>
        </div>

        <div class="divider"></div>

        <h3>‚úÖ TOU</h3>
        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">On-Peak (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="tou_on_rate" type="number" step="0.0001" value="{{ settings.tou_on_rate }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">Off-Peak (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="tou_off_rate" type="number" step="0.0001" value="{{ settings.tou_off_rate }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>
            <input name="tou_service_fee" type="number" step="0.01" value="{{ settings.tou_service_fee }}"/>
          </div>
        </div>

        <div class="row gap mt2">
          <div class="mini grow">
            <div class="mini-title">On-Peak ‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
            <input name="on_peak_start" type="number" min="0" max="23" step="1" value="{{ settings.on_peak_start }}"/>
          </div>
          <div class="mini grow">
            <div class="mini-title">On-Peak ‡∏à‡∏ö (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
            <input name="on_peak_end" type="number" min="0" max="23" step="1" value="{{ settings.on_peak_end }}"/>
          </div>
        </div>

        <div class="row gap mt2">
          <button class="btn primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>

        <div class="muted small mt2">
          ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î VAT 7% ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞ Ft ‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å ‚Äú‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‚Äù
        </div>
      </form>
    </section>

    <aside class="card">
      <h2>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
      <div class="muted small">‡πÅ‡∏™‡∏î‡∏á 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
      <div class="mt2">
        {% for u in users %}
          <div style="padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.08);">
            <div class="row between">
              <div>
                <div class="mini-title">#{{ u.id }} ‚Ä¢ {{ u.username }}</div>
                <div class="muted small">role: {{ u.role }} ‚Ä¢ points: {{ u.points or 0 }} ‚Ä¢ level: {{ u.house_level or 1 }}</div>
              </div>
              <a class="btn" href="{{ url_for('admin_user', user_id=u.id) }}">‡∏î‡∏π</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </aside>
  </main>
</div>
</body>
</html>
