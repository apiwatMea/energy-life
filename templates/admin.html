<!-- templates/admin.html -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Ä¢ ENERGY LIFE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>
<body class="bg">
<div class="shell">
  <header class="top bar">
    <div class="row gap">
      <div class="title">üõ† Admin</div>
      <a class="btn" href="{{ url_for('home') }}">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    </div>
  </header>

  <main class="grid2">
    <section class="card">
      <h2>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <div class="grid3 mt2">
        <div class="mini"><div class="mini-title">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div class="big">{{ total_users }}</div></div>
        <div class="mini"><div class="mini-title">Active 7 ‡∏ß‡∏±‡∏ô</div><div class="big">{{ active_7d }}</div></div>
        <div class="mini"><div class="mini-title">Active 30 ‡∏ß‡∏±‡∏ô</div><div class="big">{{ active_30d }}</div></div>
        <div class="mini"><div class="mini-title">Active ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div><div class="big">{{ todays }}</div></div>
        <div class="mini"><div class="mini-title">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ kWh/‡∏ß‡∏±‡∏ô</div><div class="big">{{ "%.2f"|format(avg_kwh) }}</div></div>
        <div class="mini"><div class="mini-title">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü/‡∏ß‡∏±‡∏ô</div><div class="big">{{ "%.0f"|format(avg_cost) }}</div></div>
      </div>

      <div class="divider"></div>

      <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚Äú‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù</h2>
      <form method="post" action="{{ url_for('admin_settings') }}">
        <h3>Ft</h3>
        <div class="row gap mt">
          <div class="mini grow">
            <div class="mini-title">Ft (‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="ft_rate" value="{{ settings.get('ft_rate', 0) }}" />
          </div>
          <div class="mini grow">
            <div class="mini-title">Label ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏á‡∏ß‡∏î (‡πÄ‡∏ä‡πà‡∏ô 04/2026)</div>
            <input name="ft_label" value="{{ settings.get('ft_label', 'manual') }}" />
          </div>
          <div class="mini grow">
            <div class="mini-title">VAT</div>
            <input name="vat_rate" value="{{ settings.get('vat_rate', 0.07) }}" />
          </div>
        </div>

        <div class="divider"></div>

        <h3>Non-TOU (‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î)</h3>
        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">‡∏Ç‡∏±‡πâ‡∏ô 1 ‡∏ñ‡∏∂‡∏á (kWh)</div>
            <input name="non_tou_tier1_kwh" value="{{ settings.get('non_tou_tier1_kwh', 150) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏Ç‡∏±‡πâ‡∏ô 2 ‡∏ñ‡∏∂‡∏á (kWh)</div>
            <input name="non_tou_tier2_kwh" value="{{ settings.get('non_tou_tier2_kwh', 400) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>
            <input name="non_tou_service_fee" value="{{ settings.get('non_tou_service_fee', 24.62) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ç‡∏±‡πâ‡∏ô 1 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_rate1" value="{{ settings.get('non_tou_rate1', 3.2484) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ç‡∏±‡πâ‡∏ô 2 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_rate2" value="{{ settings.get('non_tou_rate2', 4.2218) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ç‡∏±‡πâ‡∏ô 3 (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="non_tou_rate3" value="{{ settings.get('non_tou_rate3', 4.4217) }}"/>
          </div>
        </div>

        <div class="divider"></div>

        <h3>TOU</h3>
        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">On-Peak (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="tou_on_rate_real" value="{{ settings.get('tou_on_rate_real', 5.7982) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">Off-Peak (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</div>
            <input name="tou_off_rate_real" value="{{ settings.get('tou_off_rate_real', 2.6369) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</div>
            <input name="tou_service_fee" value="{{ settings.get('tou_service_fee', 24.62) }}"/>
          </div>
        </div>

        <div class="grid3 mt2">
          <div class="mini">
            <div class="mini-title">On-Peak ‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
            <input name="on_peak_start" value="{{ settings.get('on_peak_start', 9) }}"/>
          </div>
          <div class="mini">
            <div class="mini-title">On-Peak ‡∏à‡∏ö (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
            <input name="on_peak_end" value="{{ settings.get('on_peak_end', 22) }}"/>
          </div>
        </div>

        <div class="row gap mt2">
          <button class="btn primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>

        <div class="muted small mt2">
          ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Ft ‡πÅ‡∏•‡∏∞ VAT ‡∏à‡∏≤‡∏Å ‚Äú(‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ê‡∏≤‡∏ô + Ft)‚Äù
        </div>
      </form>
    </section>

    <aside class="card">
      <h2>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
      <div class="muted small">‡πÅ‡∏™‡∏î‡∏á 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
      <div class="panel mt2">
        {% for u in users %}
          <div style="padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.08);">
            <div class="row between">
              <div>
                <div class="mini-title">#{{ u.id }} ‚Ä¢ {{ u.username }}</div>
                <div class="muted small">role: {{ u.role }} ‚Ä¢ points: {{ u.points or 0 }} ‚Ä¢ level: {{ u.house_level or 1 }}</div>
              </div>
              <a class="btn" href="{{ url_for('admin_user', user_id=u.id) }}">‡∏î‡∏π</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </aside>
  </main>
</div>
</body>
</html>
