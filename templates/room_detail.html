<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Ä¢ {{ room_id }} ‚Ä¢ {{ app_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>

<body class="bg">
<div class="shell">

  <!-- ===== Header ===== -->
  <header class="top bar">
    <div class="row gap">
      <a class="btn" href="{{ url_for('rooms_setup') }}">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</a>
      <div>
        <div class="title">üß© ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</div>
        <div class="subtitle">
          ‡∏´‡πâ‡∏≠‡∏á: <strong>{{ room_id }}</strong> ({{ room.type }})
        </div>
      </div>
    </div>
  </header>

  <main class="card">

    <!-- ===== Flash ===== -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt">
        {% for cat,msg in messages %}
          <div class="toast {{cat}}">{{ msg }}</div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="post" class="form mt">

      {% for key, cfg in room.appliances.items() %}
        {% set c = catalog.get(key) %}

        <div class="mini mt">

          <!-- ===================== -->
          <!-- Header ‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
          <!-- ===================== -->
          <div class="row gap" style="justify-content:space-between;align-items:center;">
            <div>
              <div class="mini-title">
                {{ c.icon if c else "üîß" }}
                {{ c.name if c else key }}
              </div>
              <div class="muted small">
                key: {{ key }} | type: {{ c.type if c else "-" }}
              </div>
            </div>
          </div>

          <!-- ===================== -->
          <!-- 1) ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
          <!-- ===================== -->
          <div class="mt2">
            <div class="badge">‚ë† ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
            <label class="row gap mt1" style="align-items:center;">
              <input type="checkbox" name="{{ key }}__enabled"
                     {% if cfg.enabled %}checked{% endif %}>
              <span class="muted">‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</span>
            </label>
          </div>

          <!-- ===================== -->
          <!-- 2) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü -->
          <!-- ===================== -->
          <div class="mt2">
            <div class="badge">‚ë° ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü</div>

            {% if c and c.type == "ac" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">BTU</div>
                  <input type="number" name="{{ key }}__btu"
                         value="{{ cfg.btu or 12000 }}" min="6000" max="60000">
                </div>
                <div>
                  <div class="muted small">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</div>
                  <input type="number" name="{{ key }}__set_temp"
                         value="{{ cfg.set_temp or 26 }}" min="16" max="30">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours"
                         value="{{ cfg.hours or 6 }}" min="0" max="24">
                </div>
              </div>

              <label class="row gap mt1" style="align-items:center;">
                <input type="checkbox" name="{{ key }}__inverter"
                       {% if cfg.inverter %}checked{% endif %}>
                <span class="muted">Inverter (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü‡∏Å‡∏ß‡πà‡∏≤)</span>
              </label>

            {% elif c and c.type == "lights" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏•‡∏≠‡∏î</div>
                  <select name="{{ key }}__mode">
                    <option value="LED" {% if (cfg.mode or "LED") == "LED" %}selected{% endif %}>LED</option>
                    <option value="Normal" {% if (cfg.mode or "") == "Normal" %}selected{% endif %}>Normal</option>
                  </select>
                </div>
                <div>
                  <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏£‡∏ß‡∏° (W)</div>
                  <input type="number" name="{{ key }}__watts"
                         value="{{ cfg.watts or 30 }}" min="0" max="5000">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours"
                         value="{{ cfg.hours or 5 }}" min="0" max="24">
                </div>
              </div>

            {% elif c and c.type == "fridge" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">kWh ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1"
                         name="{{ key }}__kwh_per_day"
                         value="{{ cfg.kwh_per_day or 1.2 }}" min="0" max="30">
                </div>
              </div>

            {% elif c and c.type == "ev_charger" %}
              <!-- ‚úÖ EV Charger (‡πÅ‡∏ö‡∏ö B: ‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏á‡πà‡∏≤‡∏¢ ‚ë†‚ë°‚ë¢) -->
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ä‡∏≤‡∏£‡πå‡∏à (kW)</div>
                  <select name="{{ key }}__charger_kw">
                    {% for kw in [3.5,7.4,11,22] %}
                      <option value="{{kw}}" {% if (cfg.charger_kw or 7.4) == kw %}selected{% endif %}>{{kw}}</option>
                    {% endfor %}
                  </select>
                </div>

                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ä‡∏≤‡∏£‡πå‡∏à/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1"
                         name="{{ key }}__hours"
                         value="{{ cfg.hours or 2.0 }}" min="0" max="24">
                </div>

                <div>
                  <div class="muted small">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (0.50‚Äì1.00)</div>
                  <input type="number" step="0.01"
                         name="{{ key }}__eff"
                         value="{{ cfg.eff or 0.90 }}" min="0.5" max="1.0">
                </div>
              </div>

            {% else %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü (W)</div>
                  <input type="number" name="{{ key }}__watts"
                         value="{{ cfg.watts or 100 }}" min="0" max="100000">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours"
                         value="{{ cfg.hours or 1 }}" min="0" max="24">
                </div>
              </div>
            {% endif %}
          </div>

          <!-- ===================== -->
          <!-- 3) ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) -->
          <!-- ===================== -->
          {% if c and c.type == "ac" %}
            <div class="mt2">
              <div class="badge">‚ë¢ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                  <input type="number" name="{{ key }}__start_hour"
                         value="{{ cfg.start_hour or 20 }}" min="0" max="23">
                </div>
                <div>
                  <div class="muted small">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                  <input type="number" name="{{ key }}__end_hour"
                         value="{{ cfg.end_hour or 2 }}" min="0" max="23">
                </div>
              </div>
              <div class="muted small mt1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 20 ‚Üí 2)</div>
            </div>

          {% elif c and c.type == "ev_charger" %}
            <div class="mt2">
              <div class="badge">‚ë¢ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏≤‡∏£‡πå‡∏à (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                  <input type="number" name="{{ key }}__start_hour"
                         value="{{ cfg.start_hour or 22 }}" min="0" max="23">
                </div>
                <div>
                  <div class="muted small">‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏≤‡∏£‡πå‡∏à (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                  <input type="number" name="{{ key }}__end_hour"
                         value="{{ cfg.end_hour or 2 }}" min="0" max="23">
                </div>
              </div>
              <div class="muted small mt1">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏ä‡πà‡∏ß‡∏á <b>Off-Peak</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î</div>
            </div>
          {% endif %}

        </div>
      {% endfor %}

      <!-- ===== Actions ===== -->
      <div class="row gap mt">
        <button class="btn primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        <a class="btn" href="{{ url_for('rooms_setup') }}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
      </div>

    </form>
  </main>
</div>
</body>
</html>
