<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Ä¢ {{ room_id }} ‚Ä¢ {{ app_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>

<body class="bg">
<div class="shell">

  <header class="top bar">
    <div class="row gap">
      <a class="btn" href="{{ url_for('rooms_setup') }}">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</a>
      <div>
        <div class="title">üß© ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</div>
        <div class="subtitle">
          ‡∏´‡πâ‡∏≠‡∏á: <strong>{{ room_id }}</strong> ({{ room.type }})
        </div>
      </div>
    </div>
  </header>

  <main class="card">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt">
        {% for cat,msg in messages %}
          <div class="toast {{cat}}">{{ msg }}</div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="post" class="form mt">

      {% for key, cfg in room.appliances.items() %}
        {% set c = catalog.get(key) %}

        <div class="mini mt">

          <div class="row gap" style="justify-content:space-between;align-items:center;">
            <div>
              <div class="mini-title">
                {{ c.icon if c else "üîß" }}
                {{ c.name if c else key }}
              </div>
              <div class="muted small">
                key: {{ key }} | type: {{ c.type if c else "-" }}
              </div>
            </div>
          </div>

          <div class="mt2">
            <div class="badge">‚ë† ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>

            <div class="mt1">
              <label class="checkline">
                <input type="checkbox" name="{{ key }}__enabled" {% if cfg.enabled %}checked{% endif %}>
                <span>‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</span>
              </label>
            </div>
          </div>

          <div class="mt2">
            <div class="badge">‚ë° ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü</div>

            {% if c and c.type == "ac" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">BTU</div>
                  <input type="number" name="{{ key }}__btu" value="{{ cfg.btu or 12000 }}" min="6000" max="60000">
                </div>
                <div>
                  <div class="muted small">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</div>
                  <input type="number" name="{{ key }}__set_temp" value="{{ cfg.set_temp or 26 }}" min="16" max="30">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 6 }}" min="0" max="24">
                </div>
              </div>

              <div class="mt1">
                <label class="checkline">
                  <input type="checkbox" name="{{ key }}__inverter" {% if cfg.inverter %}checked{% endif %}>
                  <span>Inverter <span class="hint">(‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏ü‡∏Å‡∏ß‡πà‡∏≤)</span></span>
                </label>
              </div>

            {% elif c and c.type == "lights" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏•‡∏≠‡∏î</div>
                  <select name="{{ key }}__mode">
                    <option value="LED" {% if cfg.mode == "LED" %}selected{% endif %}>LED</option>
                    <option value="Normal" {% if cfg.mode == "Normal" %}selected{% endif %}>Normal</option>
                  </select>
                </div>
                <div>
                  <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏£‡∏ß‡∏° (W)</div>
                  <input type="number" name="{{ key }}__watts" value="{{ cfg.watts or 30 }}" min="0" max="5000">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 5 }}" min="0" max="24">
                </div>
              </div>

            {% elif c and c.type == "fridge" %}
              <!-- ‚úÖ ‡πÄ‡∏ü‡∏™ 1 (‡πÅ‡∏ú‡∏ô A): ‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Å‡∏µ‡πà‡∏Ñ‡∏¥‡∏ß + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á + ‡πÄ‡∏õ‡∏¥‡∏î/‡∏ß‡∏±‡∏ô" -->
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô (‡∏Ñ‡∏¥‡∏ß)</div>
                  <select name="{{ key }}__size_band">
                    <option value="6_9" {% if cfg.size_band == "6_9" %}selected{% endif %}>6‚Äì9 ‡∏Ñ‡∏¥‡∏ß</option>
                    <option value="10_14" {% if cfg.size_band == "10_14" or not cfg.size_band %}selected{% endif %}>10‚Äì14 ‡∏Ñ‡∏¥‡∏ß</option>
                    <option value="15_18" {% if cfg.size_band == "15_18" %}selected{% endif %}>15‚Äì18 ‡∏Ñ‡∏¥‡∏ß</option>
                    <option value="19_25" {% if cfg.size_band == "19_25" %}selected{% endif %}>19‚Äì25 ‡∏Ñ‡∏¥‡∏ß</option>
                  </select>
                  <div class="muted small mt1">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì kWh/‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                </div>

                <div>
                  <div class="muted small">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
                  <input type="number" name="{{ key }}__qty" value="{{ cfg.qty or 1 }}" min="1" max="10">
                  <div class="muted small mt1">‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏µ 2 ‡∏ï‡∏π‡πâ</div>
                </div>

                <div>
                  <div class="muted small">‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div>
                  <input type="number" name="{{ key }}__open_times" value="{{ cfg.open_times or 20 }}" min="0" max="200">
                  <div class="muted small mt1">‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‚âà 20 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ß‡∏±‡∏ô</div>
                </div>
              </div>

            {% elif c and c.type == "ev_charger" %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡πÅ‡∏ö‡∏ï (kWh)</div>
                  <input type="number" step="1" name="{{ key }}__battery_kwh" value="{{ cfg.battery_kwh or 60 }}" min="20" max="200">
                </div>
                <div>
                  <div class="muted small">Charger (kW)</div>
                  <input type="number" step="0.1" name="{{ key }}__charger_kw" value="{{ cfg.charger_kw or 7.4 }}" min="1" max="50">
                </div>
                <div>
                  <div class="muted small">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (0.50‚Äì1.00)</div>
                  <input type="number" step="0.01" name="{{ key }}__efficiency" value="{{ cfg.efficiency or 0.9 }}" min="0.5" max="1.0">
                </div>
              </div>

              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏à‡∏≤‡∏Å %</div>
                  <input type="number" name="{{ key }}__soc_from" value="{{ cfg.soc_from or 30 }}" min="0" max="100">
                </div>
                <div>
                  <div class="muted small">‡∏ñ‡∏∂‡∏á %</div>
                  <input type="number" name="{{ key }}__soc_to" value="{{ cfg.soc_to or 80 }}" min="0" max="100">
                </div>
                <div>
                  <div class="muted small">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ä‡∏≤‡∏£‡πå‡∏à/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                  <input type="number" name="{{ key }}__charges_per_week" value="{{ cfg.charges_per_week or 3 }}" min="0" max="14">
                </div>
              </div>

              <div class="mt2">
                <div class="badge">‚ë¢ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
                <div class="grid3 mt1">
                  <div>
                    <div class="muted small">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏≤‡∏£‡πå‡∏à (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                    <input type="number" name="{{ key }}__start_hour" value="{{ cfg.start_hour or 22 }}" min="0" max="23">
                    <div class="muted small mt1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ä‡∏≤‡∏£‡πå‡∏à‚Äù ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å % ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ä‡∏≤‡∏£‡πå‡∏à</div>
                  </div>
                </div>
              </div>

            {% else %}
              <div class="grid3 mt1">
                <div>
                  <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü (W)</div>
                  <input type="number" name="{{ key }}__watts" value="{{ cfg.watts or 100 }}" min="0" max="100000">
                </div>
                <div>
                  <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                  <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 1 }}" min="0" max="24">
                </div>
              </div>
            {% endif %}
          </div>

          {% if c and c.type == "ac" %}
          <div class="mt2">
            <div class="badge">‚ë¢ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
            <div class="grid3 mt1">
              <div>
                <div class="muted small">‡πÄ‡∏£‡∏¥‡πà‡∏° (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                <input type="number" name="{{ key }}__start_hour" value="{{ cfg.start_hour or 20 }}" min="0" max="23">
              </div>
              <div>
                <div class="muted small">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                <input type="number" name="{{ key }}__end_hour" value="{{ cfg.end_hour or 2 }}" min="0" max="23">
              </div>
            </div>
          </div>
          {% endif %}

        </div>
      {% endfor %}

      <div class="row gap mt">
        <button class="btn primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        <a class="btn" href="{{ url_for('rooms_setup') }}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
      </div>

    </form>
  </main>
</div>
</body>
</html>
