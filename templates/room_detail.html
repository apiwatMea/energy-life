<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Ä¢ {{ room_id }} ‚Ä¢ {{ app_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>

<body class="bg">
<div class="shell">

  <header class="top bar">
    <div class="row gap" style="justify-content:space-between;align-items:center;flex-wrap:wrap;">
      <div class="row gap" style="align-items:center;">
        <a class="btn" href="{{ url_for('rooms_setup') }}">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</a>
        <div>
          <div class="title">üß© ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</div>
          <div class="subtitle">
            ‡∏´‡πâ‡∏≠‡∏á: <b>{{ room_id }}</b> ‚Ä¢ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: <b>{{ room.type }}</b> ‚Ä¢ ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á (‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏´‡∏°‡πà)
          </div>
        </div>
      </div>

      <div class="row gap" style="align-items:center;">
        <span class="pill">
          ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡∏à‡∏≥‡∏•‡∏≠‡∏á 1 ‡∏ß‡∏±‡∏ô‚Äù
        </span>
      </div>
    </div>
  </header>

  <main class="card">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt">
          {% for cat,msg in messages %}
            <div class="toast {{cat}}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Helper: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡πà‡∏≤‡∏¢) -->
    {% set total_kwh = namespace(v=0.0) %}
    {% set total_watts = namespace(v=0.0) %}

    <div class="mini">
      <div class="mini-title">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>
      <div class="muted">
        - ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏¥‡πâ‡∏ô‡πÑ‡∏î‡πâ<br/>
        - ‡∏ñ‡πâ‡∏≤ ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‚Äù = ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏Ñ‡∏¥‡∏î‡πÑ‡∏ü‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á<br/>
        - ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ (‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ)
      </div>
    </div>

    <div class="divider"></div>

    <form method="post" class="form">

      <div class="grid2 mt">
        <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
        <div>

          {% for key, cfg in room.appliances.items() %}
            {% set c = catalog.get(key) %}

            <!-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ -->
            {% if cfg.enabled %}
              {% if c and c.type == "ac" %}
                {% set _kwh = ((cfg.btu or 12000) / 12000.0) * (cfg.hours or 6) %}
                {% set total_kwh.v = total_kwh.v + _kwh %}
              {% elif c and c.type == "fridge" %}
                {% set _kwh = (cfg.kwh_per_day or 1.2) %}
                {% set total_kwh.v = total_kwh.v + _kwh %}
              {% else %}
                {% set _kwh = ((cfg.watts or 0) / 1000.0) * (cfg.hours or 0) %}
                {% set total_kwh.v = total_kwh.v + _kwh %}
                {% set total_watts.v = total_watts.v + (cfg.watts or 0) %}
              {% endif %}
            {% endif %}

            <div class="mini mt">
              <div class="row gap" style="justify-content:space-between;align-items:center;flex-wrap:wrap;">
                <div>
                  <div class="mini-title">
                    {{ c.icon if c else "" }} {{ c.name if c else key }}
                    {% if cfg.enabled %}
                      <span class="tag ok">ON</span>
                    {% else %}
                      <span class="tag off">OFF</span>
                    {% endif %}
                  </div>
                  <div class="muted small">key: {{ key }}{% if c %} ‚Ä¢ type: {{ c.type }}{% endif %}</div>
                </div>

                <label class="row gap" style="align-items:center;">
                  <input type="checkbox" name="{{ key }}__enabled" {% if cfg.enabled %}checked{% endif %}>
                  <span class="muted">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                </label>
              </div>

              {% if c and c.type == "ac" %}
                <div class="grid3 mt2">
                  <div>
                    <div class="muted small">BTU</div>
                    <input type="number" name="{{ key }}__btu" value="{{ cfg.btu or 12000 }}" min="6000" max="60000">
                    <div class="muted small">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 9,000‚Äì18,000 BTU</div>
                  </div>
                  <div>
                    <div class="muted small">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</div>
                    <input type="number" name="{{ key }}__set_temp" value="{{ cfg.set_temp or 26 }}" min="16" max="30">
                    <div class="muted small">‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏™‡∏∏‡∏î: 26¬∞C</div>
                  </div>
                  <div>
                    <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                    <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 6 }}" min="0" max="24">
                    <div class="muted small">‡πÄ‡∏ä‡πà‡∏ô 6 ‡∏ä‡∏°./‡∏ß‡∏±‡∏ô</div>
                  </div>
                </div>

                <div class="grid3 mt2">
                  <div>
                    <div class="muted small">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                    <input type="number" name="{{ key }}__start_hour" value="{{ cfg.start_hour or 20 }}" min="0" max="23">
                  </div>
                  <div>
                    <div class="muted small">‡∏õ‡∏¥‡∏î (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                    <input type="number" name="{{ key }}__end_hour" value="{{ cfg.end_hour or 2 }}" min="0" max="23">
                  </div>
                  <div class="row gap" style="align-items:center;margin-top:22px;">
                    <input type="checkbox" name="{{ key }}__inverter" {% if cfg.inverter %}checked{% endif %}>
                    <span class="muted">Inverter</span>
                  </div>
                </div>

              {% elif c and c.type == "lights" %}
                <div class="grid3 mt2">
                  <div>
                    <div class="muted small">‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏•‡∏≠‡∏î</div>
                    <select name="{{ key }}__mode">
                      <option value="LED" {% if (cfg.mode or "LED") == "LED" %}selected{% endif %}>LED (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î)</option>
                      <option value="Normal" {% if (cfg.mode or "") == "Normal" %}selected{% endif %}>Normal</option>
                    </select>
                  </div>
                  <div>
                    <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏£‡∏ß‡∏° (W)</div>
                    <input type="number" step="1" name="{{ key }}__watts" value="{{ cfg.watts or 30 }}" min="0" max="5000">
                    <div class="muted small">‡πÄ‡∏ä‡πà‡∏ô 30W (‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á)</div>
                  </div>
                  <div>
                    <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                    <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 5 }}" min="0" max="24">
                  </div>
                </div>

              {% elif c and c.type == "fridge" %}
                <div class="grid3 mt2">
                  <div>
                    <div class="muted small">kWh ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div>
                    <input type="number" step="0.1" name="{{ key }}__kwh_per_day" value="{{ cfg.kwh_per_day or 1.2 }}" min="0" max="30">
                    <div class="muted small">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 1.2 kWh/‡∏ß‡∏±‡∏ô</div>
                  </div>
                </div>

              {% else %}
                <div class="grid3 mt2">
                  <div>
                    <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü (W)</div>
                    <input type="number" step="1" name="{{ key }}__watts" value="{{ cfg.watts or 100 }}" min="0" max="100000">
                  </div>
                  <div>
                    <div class="muted small">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ß‡∏±‡∏ô</div>
                    <input type="number" step="0.1" name="{{ key }}__hours" value="{{ cfg.hours or 1 }}" min="0" max="24">
                  </div>
                  <div class="muted small">
                    * ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà ‚Äú‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô‚Äù ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
                  </div>
                </div>
              {% endif %}
            </div>
          {% endfor %}

          <div class="row gap mt">
            <button class="btn primary" type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            <a class="btn" href="{{ url_for('rooms_setup') }}">‚Ü© ‡∏Å‡∏•‡∏±‡∏ö</a>
          </div>

        </div>

        <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ -->
        <div>
          <div class="mini">
            <div class="mini-title">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)</div>

            <div class="grid2 mt2">
              <div class="stat">
                <div class="muted small">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü/‡∏ß‡∏±‡∏ô</div>
                <div class="big">{{ "%.2f"|format(total_kwh.v) }} kWh</div>
                <div class="muted small">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>
              </div>
              <div class="stat">
                <div class="muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü‡∏£‡∏ß‡∏° (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ W)</div>
                <div class="big">{{ "%.0f"|format(total_watts.v) }} W</div>
                <div class="muted small">‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏≠‡∏£‡πå/‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô (‡∏Ñ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö kWh)</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="muted">
              <b>Tips ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</b><br/>
              ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ö‡∏≠‡∏Å ‚Äú‡∏≠‡∏¢‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‚Äù ‚Üí ‡∏•‡∏î‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô/‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå 26¬∞C<br/>
              ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏µ TOU ‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏á Off-Peak<br/>
              ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏• ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            </div>

            <div class="divider"></div>

            <div class="muted small">
              ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡πâ‡∏≠‡∏á‚Äù (Phase 2) ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Home ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏£‡∏ß‡∏°‡∏ö‡πâ‡∏≤‡∏ô‚Äù
              ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ Home ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á ‡∏ú‡∏°‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Phase ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
            </div>
          </div>
        </div>
      </div>

    </form>
  </main>
</div>

<!-- ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢: ‡∏ñ‡πâ‡∏≤ style.css ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™‡∏û‡∏ß‡∏Å‡∏ô‡∏µ‡πâ ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á ‡πÅ‡∏Ñ‡πà‡πÑ‡∏°‡πà‡∏™‡∏ß‡∏¢‡πÄ‡∏ï‡πá‡∏° -->
</body>
</html>
