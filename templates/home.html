<!-- templates/home.html -->
<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô ‚Ä¢ ENERGY LIFE</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"/>
</head>
<body class="bg">
<div class="shell">
  <header class="top bar">
    <div class="row gap">
      <div class="badge">{{ levels[house_level-1].badge }}</div>
      <div>
        <div class="title">‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á {{ profile.display_name if profile.display_name else user.username }}</div>
        <div class="subtitle">
          <span class="muted">‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</span>
          ‚Ä¢ TOU: <b id="statTariff">{{ state.tariff_mode }}</b>
          ‚Ä¢ Solar: <b id="statSolar">{{ state.solar_kw }}</b> kW
          ‚Ä¢ EV: <b id="statEv">{{ "ON" if state.ev_enabled else "OFF" }}</b>
        </div>
      </div>
    </div>

    <!-- ‡πÄ‡∏°‡∏ô‡∏π: ‡πÇ‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á -->
    <div class="row gap">
      <a class="btn" href="{{ url_for('home') }}">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a class="btn" href="{{ url_for('dashboard') }}">üìä Dashboard</a>
      <a class="btn" href="{{ url_for('user_settings') }}">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
      {% if user.role in ['admin','officer'] %}
        <a class="btn" href="{{ url_for('admin') }}">üõ† Admin</a>
      {% endif %}
      <a class="btn ghost" href="{{ url_for('logout') }}">‡∏≠‡∏≠‡∏Å</a>
    </div>
  </header>

  <main class="grid2">
    <!-- LEFT: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
    <section class="card">
      <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚Äú‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‚Äù</h2>

      <div class="grid3 mt">
        <div class="mini">
          <div class="mini-title">üë§ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
          <select id="player_type">
            <option value="kid" {{ 'selected' if profile.player_type=='kid' else '' }}>‡πÄ‡∏î‡πá‡∏Å</option>
            <option value="adult" {{ 'selected' if profile.player_type=='adult' else '' }}>‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà</option>
            <option value="family" {{ 'selected' if profile.player_type=='family' else '' }}>‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option>
          </select>
        </div>
        <div class="mini">
          <div class="mini-title">üè† ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡πâ‡∏≤‡∏ô</div>
          <select id="house_type">
            <option value="condo" {{ 'selected' if profile.house_type=='condo' else '' }}>‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î</option>
            <option value="single_1" {{ 'selected' if profile.house_type=='single_1' else '' }}>‡∏ö‡πâ‡∏≤‡∏ô 1 ‡∏ä‡∏±‡πâ‡∏ô</option>
            <option value="single_2" {{ 'selected' if profile.house_type=='single_2' else '' }}>‡∏ö‡πâ‡∏≤‡∏ô 2 ‡∏ä‡∏±‡πâ‡∏ô</option>
            <option value="single_3" {{ 'selected' if profile.house_type=='single_3' else '' }}>‡∏ö‡πâ‡∏≤‡∏ô 3 ‡∏ä‡∏±‡πâ‡∏ô</option>
          </select>
        </div>
        <div class="mini">
          <div class="mini-title">üìè ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡πâ‡∏≤‡∏ô</div>
          <select id="house_size">
            <option value="small" {{ 'selected' if profile.house_size=='small' else '' }}>‡πÄ‡∏•‡πá‡∏Å</option>
            <option value="medium" {{ 'selected' if profile.house_size=='medium' else '' }}>‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="large" {{ 'selected' if profile.house_size=='large' else '' }}>‡πÉ‡∏´‡∏ç‡πà</option>
          </select>
        </div>
      </div>

      <div class="row gap mt">
        <div class="mini grow">
          <div class="mini-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</div>
          <input id="residents" type="number" min="1" max="12" value="{{ profile.residents }}"/>
        </div>
        <div class="mini grow">
          <div class="mini-title">üßæ ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</div>
          <select id="tariff_mode">
            <option value="non_tou" {{ 'selected' if state.tariff_mode=='non_tou' else '' }}>‡∏õ‡∏Å‡∏ï‡∏¥ (Non-TOU)</option>
            <option value="tou" {{ 'selected' if state.tariff_mode=='tou' else '' }}>TOU</option>
          </select>
        </div>
        <div class="mini grow">
          <div class="mini-title">‚òÄÔ∏è Solar Mode</div>
          <select id="solar_mode">
            <option value="manual" {{ 'selected' if state.solar_mode=='manual' else '' }}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á</option>
            <option value="advisor" {{ 'selected' if state.solar_mode=='advisor' else '' }}>‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
          </select>
        </div>
        <div class="mini grow">
          <div class="mini-title">‚òÄÔ∏è Solar (kW)</div>
          <select id="solar_kw">
            {% for kw in [0,3,5,10] %}
              <option value="{{kw}}" {{ 'selected' if state.solar_kw==kw else '' }}>{{kw}} kW</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="divider"></div>

      <h3>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°) üîå</h3>
      <div class="muted small">
        ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‚Äú‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á‚Äù ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô/‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥/‡∏Ñ‡∏£‡∏±‡∏ß/‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ ‡∏Ø‡∏•‡∏Ø)
      </div>

      <div class="appliances mt2">
        {% for a in appliances_catalog %}
          {% set cfg = state.appliances[a.key] %}
          <div class="row between" style="padding:8px 0;border-bottom:1px dashed rgba(255,255,255,.08);">
            <div class="row gap">
              <div class="ap-ico">{{ a.icon }}</div>
              <div>
                <div class="ap-name">{{ a.name }}</div>
                <div class="muted small">key: {{ a.key }}</div>
              </div>
            </div>
            <div class="muted small">{{ "ON" if cfg.enabled else "OFF" }}</div>
          </div>
        {% endfor %}
      </div>

      <div class="row gap mt2">
        <a class="btn primary" href="{{ url_for('house_setup') }}">üè† ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô</a>
        <a class="btn" href="{{ url_for('rooms_setup') }}">üß© ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</a>
      </div>

      <div class="divider"></div>

      <h3>üöó ‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (EV - ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏î‡∏¥‡∏°)</h3>
      <div class="row between">
        <div class="muted">‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏î‡∏¥‡∏° (‡∏ó‡∏±‡πâ‡∏á‡∏ö‡πâ‡∏≤‡∏ô) ‚Äî ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ EV Charger ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á Parking ‡∏Å‡πá‡∏à‡∏∞‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
        <label class="pill">
          <input id="ev_enabled" type="checkbox" {{ 'checked' if state.ev_enabled else '' }}>
          ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ EV
        </label>
      </div>

      <div id="ev_panel" class="grid3 mt2">
        <div class="mini">
          <div class="mini-title">‡πÅ‡∏ö‡∏ï (kWh)</div>
          <input id="ev_batt" type="number" step="1" min="20" max="120" value="{{ state.ev.battery_kwh }}"/>
        </div>
        <div class="mini">
          <div class="mini-title">Charger (kW)</div>
          <select id="ev_charger">
            {% for kw in [3.5,7.4,11,22] %}
              <option value="{{kw}}" {{ 'selected' if state.ev.charger_kw==kw else '' }}>{{kw}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mini">
          <div class="mini-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡∏≤‡∏£‡πå‡∏à (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
          <input id="ev_start" type="number" min="0" max="23" value="{{ state.ev.charge_start_hour }}"/>
        </div>
        <div class="mini">
          <div class="mini-title">‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏à‡∏≤‡∏Å % ‚Üí %</div>
          <div class="row gap">
            <input id="ev_from" type="number" min="0" max="100" value="{{ state.ev.soc_from }}"/>
            <span class="muted">‚Üí</span>
            <input id="ev_to" type="number" min="0" max="100" value="{{ state.ev.soc_to }}"/>
          </div>
        </div>
      </div>

      <div class="row gap mt2">
        <button class="btn" id="saveBtn" type="button">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        <button class="btn primary" id="simBtn" type="button">‚ñ∂ ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏±‡∏ô</button>
        <div class="muted small">Day: <b id="dayCounter">{{ state.day_counter }}</b></div>
      </div>
    </section>

    <!-- RIGHT: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á -->
    <aside class="card">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡πà‡∏≠ (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á)</h2>
      <div class="grid3 mt2">
        <div class="mini">
          <div class="mini-title">‚ö° kWh ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          <div class="big" id="statKwhDay">‚Äî</div>
          <div class="muted small">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
        </div>
        <div class="mini">
          <div class="mini-title">üí∞ ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          <div class="big" id="statCostDay">‚Äî</div>
          <div class="muted small">‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô</div>
        </div>
        <div class="mini">
          <div class="mini-title">üìÖ ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
          <div class="big" id="statCostMonth">‚Äî</div>
          <div class="muted small">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ √ó 30‚Äù</div>
        </div>
      </div>

      <div class="divider"></div>

      <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
      <div class="panel" id="resultBox">
        <div class="muted">‡∏Å‡∏î ‚Äú‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 1 ‡∏ß‡∏±‡∏ô‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</div>
      </div>

      <!-- ‚úÖ NEW: ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á -->
      <div class="divider"></div>

      <h3>üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü ‚Äú‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á‚Äù</h3>
      <div class="panel" id="roomsSummary">
        <div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á (‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà ‚Äú‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
      </div>

      <div class="divider"></div>

      <h3>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏£‡πá‡∏ß‡πÜ</h3>
      <ul class="tips">
        <li>‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå <b>26¬∞C</b> ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î</li>
        <li>‡πÄ‡∏õ‡∏¥‡∏î TOU ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏á <b>Off-Peak</b></li>
        <li>Solar ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞</li>
        <li>‡∏ä‡∏≤‡∏£‡πå‡∏à EV ‡∏ä‡πà‡∏ß‡∏á‡∏î‡∏∂‡∏Å‡∏à‡∏∞‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏ß‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô TOU)</li>
      </ul>
    </aside>
  </main>
</div>

<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
